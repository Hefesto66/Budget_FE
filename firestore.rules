
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
  
    // =============================================================
    // Regras Multi-Inquilino: Protege os dados de cada empresa
    // =============================================================
    // Estas regras garantem que um utilizador só pode aceder
    // aos documentos que pertencem à sua empresa.
    // O `request.auth.uid` é o ID do utilizador autenticado.
    // O `resource.data.companyId` é o campo que guardamos em cada documento.
    
    match /clients/{clientId} {
      allow read, write: if request.auth.uid == resource.data.companyId;
    }

    match /inventory/{productId} {
      allow read, write: if request.auth.uid == resource.data.companyId;
    }
    
    match /leads/{leadId} {
      allow read, write: if request.auth.uid == resource.data.companyId;
    }
    
    match /quotes/{quoteId} {
      allow read, write: if request.auth.uid == resource.data.companyId;
    }

    // =============================================================
    // Regra para a Empresa: Permite que um utilizador gira os seus
    // próprios dados de empresa.
    // =============================================================
    // O `companyId` aqui é o próprio ID do utilizador.
    match /companies/{companyId} {
      allow read, write: if request.auth.uid == companyId;
    }
  }
}
